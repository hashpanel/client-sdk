language: node_js
node_js:
  - '0.10'

addons:
  postgresql: '9.3'

services:
  - redis-server

notifications:
  email: false

# use docker (http://blog.travis-ci.com/2014-12-17-faster-builds-with-container-based-infrastructure)
sudo: false

env:
  global:
    - REDIS_URL=redis://:@localhost:6379
    - DATABASE_URL=postgres://hashpanel:hashpanel@localhost:5432/hashpanel

before_script:
  - cd node_modules/hashware-api/node_modules/hashware-backbone-client
  - npm link ../../../../
  - cd ../../../../

  - cd node_modules/hashware-api/node_modules/sails-backbone
  - npm link ../../../../
  - cd ../../../../

before_install:
  - psql -c "create database hashpanel;" -U postgres
  - psql -c "create user hashpanel with password 'hashpanel';" -U postgres
  - psql -c "grant all privileges on database hashpanel to hashpanel;" -U postgres
  - npm install hashware-api

before_script:
  - npm start hashware-api &
  - sleep 20
